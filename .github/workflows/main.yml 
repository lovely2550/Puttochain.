# ... (ส่วน name, on, env เหมือนเดิม) ...

jobs:
  # 1. Build และ Test Logic (CI)
  build-and-test:
    runs-on: ubuntu-latest
    steps:
    - name: Checkout code
      uses: actions/checkout@v4

    - name: Set up Python ${{ env.PYTHON_VERSION }}
      uses: actions/setup-python@v5
      with:
        python-version: ${{ env.PYTHON_VERSION }}
        
    - name: Install dependencies (Fixed)
      run: |
        # ติดตั้งแพ็กเกจหลักทั้งหมด และ dependencies สำหรับการทดสอบ
        pip install fastapi uvicorn[standard] pydantic web3 python-dotenv sqlalchemy psycopg2-binary
        pip install -e .
        pip install pytest pytest-cov flake8

    - name: Lint with Flake8
      run: |
        # ... (คำสั่ง Lint เหมือนเดิม) ...

    - name: Run Pytest and calculate Coverage
      run: |
        # รันชุดทดสอบทั้งหมด
        pytest --cov=puttochain --cov-report=xml

    - name: Upload coverage report to Codecov
      uses: codecov/codecov-action@v4 

  # ... (ส่วน build-and-push-docker และ deploy เหมือนเดิม) ...
